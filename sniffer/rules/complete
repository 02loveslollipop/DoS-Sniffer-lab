# Placeholder for custom.rules
# Add your custom Snort 3 rules here.

# Example rule (ICMP Ping)
# alert icmp any any -> $home_net any (msg:"ICMP Ping"; sid:1000001; rev:1;)

# Custom Snort 3 Rules for DoS Attack Simulation

# --- Land Attack ---
# Detects TCP packets where source IP equals destination IP AND source port equals destination port.
# Snort 3 uses 'same_ip' for this, not a 'land' keyword.
alert tcp $EXTERNAL_NET any -> $HOME_NET any ( \
    msg:"DOS Land Attack Detected (Matching IP/Port)"; \
    same_ip:yes; \
    flow:to_server; \
    sid:1000001; \
    rev:1; \
    classtype:dos; \
    metadata:service dns, service ftp, service http, service imap, service pop3, service smtp, service ssh, service telnet, service web, attack_target Server, created_at 2024_05_18, updated_at 2024_05_18; \
)

# --- TCP SYN Flood ---
# Detects a high number of SYN packets to any port on the home network.
alert tcp $EXTERNAL_NET any -> $HOME_NET any ( \
    msg:"DOS TCP SYN Flood Detected"; \
    flags:S; \
    flow:to_server; \
    detection_filter:track by_dst, count 100, seconds 10; \
    sid:1000002; \
    rev:1; \
    classtype:dos; \
    metadata:service dns, service ftp, service http, service imap, service pop3, service smtp, service ssh, service telnet, service web, attack_target Server, created_at 2024_05_18, updated_at 2024_05_18; \
)

# --- Teardrop Attack ---
# Detects IP fragments with suspicious characteristics indicative of a Teardrop attack.

# Rule 1: Detects first fragment (offset 0) that also has More Fragments bit set AND a small fragment length.
alert ip $EXTERNAL_NET any -> $HOME_NET any ( \
    msg:"DOS Teardrop Attack Fragment Detected (MF set, offset 0, small frag)"; \
    fragbits:M; \
    fragoffset:0; \
    dsize:<60; \
    flow:to_server; \
    sid:1000003; \
    rev:1; \
    classtype:dos; \
    metadata:attack_target Server, created_at 2024_05_18, updated_at 2024_05_18; \
)

# Rule 2: Detects non-zero offset fragments with More Fragments bit, small size.
alert ip $EXTERNAL_NET any -> $HOME_NET any ( \
    msg:"DOS Teardrop Attack Fragment Detected (MF set, non-zero offset, small frag)"; \
    fragbits:M; \
    fragoffset:>0; \
    dsize:<60; \
    flow:to_server; \
    sid:1000004; \
    rev:1; \
    classtype:dos; \
    metadata:attack_target Server, created_at 2024_05_18, updated_at 2024_05_18; \
)

# --- All other rules are commented out for focused testing ---
# FTP APPE Flood
# alert tcp $EXTERNAL_NET any -> $HOME_NET 21 ( \
#     msg:"FTP APPE Flood"; \
#     flow:to_server,established; \
#     flags:A+; \
#     content:"APPE"; \
#     nocase; \
#     threshold: type limit, track by_src, count 10, seconds 1; \
#     classtype:attempted-dos; \
#     sid:1000013; \
#     rev:1; \
# )

# Fragmented ICMP Teardrop Attack
# alert tcp $EXTERNAL_NET any -> $HOME_NET any ( \
#     msg:"Fragmented ICMP Teardrop Attack"; \
#     fragbits:M; \
#     flow:stateless; \
#     classtype:attempted-dos; \
#     sid:1000014; \
#     rev:1; \
# )

alert tcp any any -> $HOME_NET any (msg:"Test HOME_NET"; sid:1000001; rev:1;)

