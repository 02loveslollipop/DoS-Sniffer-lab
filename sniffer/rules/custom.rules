# Placeholder for custom.rules
# Add your custom Snort 3 rules here.

# Example rule (ICMP Ping)
# alert icmp any any -> $home_net any (msg:"ICMP Ping"; sid:1000001; rev:1;)

# Custom Snort 3 Rules for DoS Attack Simulation

# --- Land Attack ---
# Detects TCP packets where source IP equals destination IP AND source port equals destination port.
# This is a classic Land attack signature.
alert tcp any any -> $HOME_NET any ( \
    msg:"DOS Land Attack Detected (Matching IP/Port)"; \
    flow:to_server; \
    land; \
    sid:1000001; \
    rev:1; \
    classtype:dos; \
    metadata:service dns, service ftp, service http, service imap, service pop3, service smtp, service ssh, service telnet, service web, attack_target Server, created_at 2024_05_18, updated_at 2024_05_18; \
)

# --- TCP SYN Flood ---
# Detects a high number of SYN packets to any port on the home network.
# This rule uses event_filter to count SYN packets over a short period.
# Adjust count and seconds as needed for your environment and testing.
# The target port is 'any' here, but you could specify common ports like 80, 443, etc.
alert tcp $EXTERNAL_NET any -> $HOME_NET any ( \
    msg:"DOS TCP SYN Flood Detected"; \
    flags:S,CE,U,P; \
    flow:to_server,only_syn; \
    detection_filter:track by_dst, count 100, seconds 10; \
    sid:1000002; \
    rev:1; \
    classtype:dos; \
    metadata:service dns, service ftp, service http, service imap, service pop3, service smtp, service ssh, service telnet, service web, attack_target Server, created_at 2024_05_18, updated_at 2024_05_18; \
)

# --- Teardrop Attack ---
# Detects IP fragments with suspicious characteristics indicative of a Teardrop attack.
# Snort's stream and IP defragmentation preprocessors are crucial for this.

# Rule 1: Detects first fragment (offset 0) that also has More Fragments bit set AND a small fragment length.
alert ip $EXTERNAL_NET any -> $HOME_NET any ( \
    msg:"DOS Teardrop Attack Fragment Detected (MF set, offset 0, small frag)"; \
    fragbits:M; \
    fragoffset:0; \
    dsize:<60; \
    flow:to_server; \
    sid:1000003; \
    rev:1; \
    classtype:dos; \
    metadata:attack_target Server, created_at 2024_05_18, updated_at 2024_05_18; \
)

# Rule 2: Detects non-zero offset fragments with More Fragments bit, small size.
alert ip $EXTERNAL_NET any -> $HOME_NET any ( \
    msg:"DOS Teardrop Attack Fragment Detected (MF set, non-zero offset, small frag)"; \
    fragbits:M; \
    fragoffset:>0; \
    dsize:<60; \
    flow:to_server; \
    sid:1000004; \
    rev:1; \
    classtype:dos; \
    metadata:attack_target Server, created_at 2024_05_18, updated_at 2024_05_18; \
)

# Note: Snort 3's internal defragmentation (host inspector) should also help identify
# malformed fragment attacks like overlaps. These rules provide explicit checks for common patterns.

